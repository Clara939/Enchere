<!DOCTYPE html>
<html lang="fr" th:replace="~{layout/layout :: frag_layout(content=~{::main})}">
<main>
    <h2 class="titre-gradient">Liste des ench√®res</h2>
    <div id="encheres_corps_principal">
        <!--        <section id="encheres_section_filtres">-->
        <form id="encheres_form_filtre" th:action="@{/encheres/filtres}" method="post">
            <div>
                <h3>Filtres</h3>
                <div class="bloc_filtre">
                    <label for="encheres_input_recherche">Recherche :</label>
                    <input id="encheres_input_recherche" type="search" name="search" placeholder="üîçÔ∏é le nom contient" th:value="${search}">
                    <!--                        th:value permet d'afficher le mot recherch√© sur la page des r√©sultats-->
                </div>
                <div class="bloc_filtre">
                    <label for="encheres_select_categories">Cat√©gories :</label>
                    <select id="encheres_select_categories" name="categorie">
                        <option value="0" th:selected="${id_categorie_selectionnee == 0}">Toutes les cat√©gories</option>
                        <!--                            th:selected="condition" : l'option est s√©lectionn√©e si la condition est v√©rifi√©e-->
                        <option th:each="cat : ${categorieList}"
                                th:text="${cat.getLibelle()}"
                                th:value="${cat.getId_categorie()}"
                                th:selected="${cat.getId_categorie() == id_categorie_selectionnee}">
                        </option>
                    </select>
                </div>
            </div>
            <div id="encheres_form_mes_encheres" th:if="${#authorization.expression('isAuthenticated()')}">
                <div class="bloc_filtre bloc_achat">
                    <input type="radio" id="encheres_radio_achats" name="encheres_radio" th:checked="${achat}" value="achat" checked>
                    <label for="encheres_radio_achats">Achats</label>
                    <div class="encheres_checkbox">
                        <input type="checkbox" name="encheres_ouvertes" id="encheres_ouvertes" th:checked="${encheres_ouvertes}"> <label for="encheres_ouvertes">Ench√®res ouvertes</label><br>
                        <input type="checkbox" name="mes_encheres_cours" id="mes_encheres_cours" th:checked="${mes_encheres_cours}"> <label for="mes_encheres_cours">Mes ench√®res en cours</label><br>
                        <!--                        th:checked="condition" : la condition (bool√©en) est true si la case est coch√©e-->
                        <input type="checkbox" name="mes_encheres_remportees" id="mes_encheres_remportees" th:checked="${mes_encheres_remportees}"> <label for="mes_encheres_remportees">Mes ench√®res remport√©es</label><br>
                    </div>
                </div>
                <div class="bloc_filtre bloc_vente">
                    <input type="radio" id="encheres_radio_ventes" name="encheres_radio" th:checked="${vente}" value="vente">
                    <label for="encheres_radio_ventes">Mes ventes</label>
                    <div class="encheres_checkbox">
                        <input type="checkbox" name="mes_ventes_cours" id="mes_ventes_cours" th:checked="${mes_ventes_cours}"> <label for="mes_ventes_cours">Ventes en cours</label><br>
                        <input type="checkbox" name="ventes_non_debutees" id="ventes_non_debutees" th:checked="${ventes_non_debutees}"> <label for="ventes_non_debutees">Ventes non d√©but√©es</label><br>
                        <input type="checkbox" name="ventes_terminees" id="ventes_terminees" th:checked="${ventes_terminees}"> <label for="ventes_terminees">Ventes termin√©es</label><br>
                    </div>
                </div>
            </div>

            <button type="submit" class="boutonOrange">RECHERCHER</button>
        </form>
        <!--        </section>-->
        <!--        <section id="encheres_section_liste_encheres">-->
        <div th:each="article : ${articleList}" class="encheres_article_vente">
            <h3 th:text="${article.getNom_article()}"></h3>
            <img class="encheres_photo_article"
                 th:src="${article.photoArticle} ?: '/images/marteau.jpg'"
                 th:alt="${article.nom_article}"/>

            <div class="encheres_article_infos">
                <div>
                    <p>Prix actuel :
                        <strong>
                            <span th:text="${(article.getPrix_vente() != null) ? article.getPrix_vente() : article.getPrix_initial()}"></span>
                            <span> ü•ï</span></strong></p>
                    <p>Fin de l'ench√®re :
                        <strong><span th:text="${article.getDate_fin_encheres()}"></span></strong></p>
                    <p th:if="${article.getVendeur() != null}">Vendeur :
                        <a id="lienVersProfil" th:href="@{/afficheProfilVendeur(id=${article.getVendeur().getId_utilisateur()})}"><strong><span th:text="${article.getVendeur().getPseudo()}"></span></strong></a></p>
                    <!--                lien vers la liste des encherisseurs-->
                    <p  th:if="${#authorization.expression('isAuthenticated()') and vente == true and (article.getEtat_vente() == 'EN_VENTE' or article.getEtat_vente() == 'VENDU') and article.getPrix_vente() != null and article.getPrix_vente()>article.getPrix_initial()}">Liste des <a class="encheres_lien_encherisseurs" th:href="@{/Encherisseurs/list(id=${article.getId_article()})}"><strong>ench√©risseurs</strong></a></p>
                </div>
                <div>
                    <!--                    modification de l'enchere par le vendeur avant le d√©marrage de l'ench√®re-->
                    <button th:if="${#authorization.expression('isAuthenticated()') and vente == true and ventes_non_debutees == true and article.getEtat_vente() == 'CREE'}" type="button" class="boutonVert"><a th:href="@{/encheres/update(id=${article.getId_article()})}">Modifier</a></button>
                    <!--                   faire une enchere par un utilisateur autre que le vendeur si connect√©-->
                    <button th:if="${(not #authorization.expression('isAuthenticated()') or (vente != true)) and article.getEtat_vente() != 'VENDU' }" type="button" class="boutonOrange"><a th:href="@{/encherir(id=${article.id_article})}">Ench√©rir</a></button>
                    <!--                voir fiche profil acheteur si enchere termin√©e-->
                    <button th:if="${#authorization.expression('isAuthenticated()') and vente == true and ventes_terminees == true and article.getEtat_vente() == 'VENDU'}" type="button" class="boutonVert"><a th:href="@{/afficheProfilAcheteurApresAchat(id_acheteur=${article.getAcheteur().getId_utilisateur()}, id_article=${article.getId_article()})}">Contact</a></button>
                    <!--            voir fiche profil vendeur si enchere terminee-->
                    <button th:if="${#authorization.expression('isAuthenticated()') and achat == true and mes_encheres_remportees == true and article.getEtat_vente() == 'VENDU'}" type="button" class="boutonVert"><a th:href="@{/afficheProfilVendeurApresAchat(id_vendeur=${article.getVendeur().getId_utilisateur()}, id_article=${article.getId_article()})}">Contact</a></button>
                </div>
            </div>
            <!--        </section>-->
        </div>
    </div>
</main>
</html>